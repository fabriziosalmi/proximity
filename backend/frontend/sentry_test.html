<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sentry Integration Test - Proximity</title>
    <style>
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background: #0f1419;
            color: #e6edf3;
        }
        .container {
            background: #161b22;
            border: 1px solid #30363d;
            border-radius: 8px;
            padding: 30px;
        }
        h1 {
            color: #58a6ff;
            margin-top: 0;
        }
        .status {
            padding: 15px;
            border-radius: 6px;
            margin: 20px 0;
            font-family: 'Monaco', 'Courier New', monospace;
        }
        .status.loading {
            background: #1f2328;
            border: 1px solid #30363d;
        }
        .status.success {
            background: #0d3a20;
            border: 1px solid #1a7f37;
            color: #2ea043;
        }
        .status.error {
            background: #3d1e1e;
            border: 1px solid #d1242f;
            color: #f85149;
        }
        button {
            background: #238636;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            margin: 10px 5px 10px 0;
        }
        button:hover {
            background: #2ea043;
        }
        button.secondary {
            background: #21262d;
            border: 1px solid #30363d;
        }
        button.secondary:hover {
            background: #30363d;
        }
        .info {
            background: #1f2937;
            border-left: 4px solid #3b82f6;
            padding: 15px;
            margin: 20px 0;
        }
        .code {
            background: #0d1117;
            padding: 15px;
            border-radius: 6px;
            font-family: 'Monaco', 'Courier New', monospace;
            font-size: 13px;
            overflow-x: auto;
            margin: 10px 0;
        }
        a {
            color: #58a6ff;
            text-decoration: none;
        }
        a:hover {
            text-decoration: underline;
        }
        .step {
            margin: 20px 0;
            padding: 15px;
            background: #0d1117;
            border-radius: 6px;
        }
        .step h3 {
            margin-top: 0;
            color: #58a6ff;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîç Sentry Integration Test</h1>
        <p>Questa pagina verifica che l'integrazione di Sentry funzioni correttamente.</p>

        <div class="info">
            <strong>üìä Dashboard Sentry:</strong> 
            <a href="https://proximity.sentry.io" target="_blank">https://proximity.sentry.io</a>
        </div>

        <div class="step">
            <h3>Step 1: Verifica SDK</h3>
            <div id="sdkStatus" class="status loading">‚è≥ Verificando caricamento SDK...</div>
        </div>

        <div class="step">
            <h3>Step 2: Test Errore</h3>
            <p>Questo pulsante genera un errore intenzionale per verificare che Sentry lo catturi.</p>
            <button onclick="testError()">üß™ Genera Errore di Test</button>
            <button class="secondary" onclick="testEvent()">üìù Invia Evento Custom</button>
            <div id="errorStatus" class="status loading" style="display:none;"></div>
        </div>

        <div class="step">
            <h3>Step 3: Verifica Dashboard</h3>
            <p>Dopo aver cliccato i pulsanti sopra, verifica che gli eventi appaiano in Sentry:</p>
            <ol>
                <li>Vai a <a href="https://proximity.sentry.io/issues/" target="_blank">Issues Tab</a></li>
                <li>Cerca un errore recente con messaggio "myUndefinedFunction is not defined"</li>
                <li>Verifica che abbia il tag <code>context: sentry_integration_test</code></li>
                <li>Controlla il breadcrumb trail per vedere le azioni dell'utente</li>
            </ol>
            <button class="secondary" onclick="window.open('https://proximity.sentry.io/issues/', '_blank')">
                üîó Apri Dashboard Sentry
            </button>
        </div>

        <div class="step">
            <h3>üõ†Ô∏è Comandi Console</h3>
            <p>Puoi anche testare manualmente nella console del browser:</p>
            <div class="code">
// Abilita Sentry in development<br>
localStorage.setItem('sentry_debug_enabled', 'true');<br>
<br>
// Test rapido<br>
window.testSentry();<br>
<br>
// Report manuale<br>
window.reportToSentry(new Error('Test error'), {<br>
&nbsp;&nbsp;context: 'manual_test'<br>
});<br>
<br>
// Evento custom<br>
window.captureAppEvent('test_event', { test: true });
            </div>
        </div>

        <div class="step">
            <h3>üìã Checklist Integrazione</h3>
            <ul id="checklist">
                <li>‚è≥ SDK Sentry caricato</li>
                <li>‚è≥ Configurazione inizializzata</li>
                <li>‚è≥ Helper functions disponibili</li>
                <li>‚è≥ Errore di test inviato</li>
                <li>‚è≥ Evento visibile in dashboard</li>
            </ul>
        </div>
    </div>

    <!-- Sentry SDK -->
    <script
        src="https://js.sentry-cdn.com/dbee00d4782d131ab54ffe60b16d969b.min.js"
        crossorigin="anonymous"
    ></script>

    <!-- Sentry Configuration -->
    <script src="/js/sentry-config.js"></script>

    <script>
        // Enable Sentry in development for testing
        localStorage.setItem('sentry_debug_enabled', 'true');

        // Check SDK status
        window.addEventListener('load', () => {
            const sdkStatus = document.getElementById('sdkStatus');
            const checklist = document.getElementById('checklist').children;

            setTimeout(() => {
                if (typeof Sentry !== 'undefined') {
                    sdkStatus.className = 'status success';
                    sdkStatus.textContent = '‚úÖ SDK Sentry caricato correttamente!';
                    checklist[0].textContent = '‚úÖ SDK Sentry caricato';
                    checklist[1].textContent = '‚úÖ Configurazione inizializzata';
                    
                    // Check helper functions
                    if (window.testSentry && window.reportToSentry && window.captureAppEvent) {
                        checklist[2].textContent = '‚úÖ Helper functions disponibili';
                    }
                } else {
                    sdkStatus.className = 'status error';
                    sdkStatus.textContent = '‚ùå SDK Sentry non caricato';
                    checklist[0].textContent = '‚ùå SDK Sentry non caricato';
                }
            }, 1000);
        });

        function testError() {
            const errorStatus = document.getElementById('errorStatus');
            const checklist = document.getElementById('checklist').children;
            
            errorStatus.style.display = 'block';
            errorStatus.className = 'status loading';
            errorStatus.textContent = '‚è≥ Generando errore di test...';

            setTimeout(() => {
                try {
                    // This will trigger: ReferenceError: myUndefinedFunction is not defined
                    myUndefinedFunction();
                } catch (error) {
                    window.reportToSentry(error, {
                        context: 'sentry_integration_test',
                        test_triggered: true,
                        test_page: 'sentry_test.html',
                        timestamp: new Date().toISOString(),
                    });

                    errorStatus.className = 'status success';
                    errorStatus.innerHTML = `
                        ‚úÖ Errore inviato a Sentry!<br>
                        üìä Error: ${error.message}<br>
                        üîó Verifica in <a href="https://proximity.sentry.io/issues/" target="_blank">dashboard</a> tra 30 secondi
                    `;
                    
                    checklist[3].textContent = '‚úÖ Errore di test inviato';
                    checklist[4].textContent = '‚è≥ Verifica dashboard manualmente';
                }
            }, 500);
        }

        function testEvent() {
            const errorStatus = document.getElementById('errorStatus');
            
            errorStatus.style.display = 'block';
            errorStatus.className = 'status loading';
            errorStatus.textContent = '‚è≥ Inviando evento custom...';

            setTimeout(() => {
                window.captureAppEvent('sentry_test_event', {
                    test_type: 'manual',
                    test_page: 'sentry_test.html',
                    timestamp: new Date().toISOString(),
                });

                errorStatus.className = 'status success';
                errorStatus.innerHTML = `
                    ‚úÖ Evento custom inviato!<br>
                    üìù Event: sentry_test_event<br>
                    üîó Verifica in <a href="https://proximity.sentry.io/issues/" target="_blank">dashboard</a>
                `;
            }, 500);
        }
    </script>
</body>
</html>
