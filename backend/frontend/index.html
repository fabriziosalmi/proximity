<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Proximity - App Delivery Platform</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300..900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/css/styles.css">
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    
    <!-- Load legacy app.js first (non-module) -->
    <script src="app.js?v=20251008-6"></script>

    <!-- Then load modular system (ES6 modules) -->
    <script src="js/main.js?v=20251008-6" type="module"></script>
</head>
<body>
    <div class="app-container">
        <!-- Sidebar -->
        <aside class="sidebar">
            <div class="sidebar-header">
                <div class="logo">
                    <div class="logo-icon">ðŸš€</div>
                    <span class="logo-text">Proximity</span>
                </div>
                <button class="sidebar-toggle" id="sidebarToggle" aria-label="Toggle sidebar">
                    <i data-lucide="chevron-left"></i>
                </button>
            </div>
            
            <nav class="sidebar-nav">
                <div class="nav-section">
                    <div class="nav-section-title">Main</div>
                    <a href="#" class="nav-item active" data-view="dashboard">
                        <i data-lucide="layout-dashboard" class="nav-icon"></i>
                        <span>Dashboard</span>
                    </a>
                    <a href="#" class="nav-item" data-view="apps">
                        <i data-lucide="package" class="nav-icon"></i>
                        <span>My Apps</span>
                        <span class="nav-badge" id="appsCount">0</span>
                    </a>
                    <a href="#" class="nav-item" data-view="catalog">
                        <i data-lucide="store" class="nav-icon"></i>
                        <span>App Store</span>
                    </a>
                </div>
                
                <div class="nav-section">
                    <div class="nav-section-title">System</div>
                    <a href="#" class="nav-item" data-view="nodes">
                        <i data-lucide="server" class="nav-icon"></i>
                        <span>Infrastructure</span>
                    </a>
                    <a href="#" class="nav-item" data-view="monitoring">
                        <i data-lucide="activity" class="nav-icon"></i>
                        <span>Monitoring</span>
                    </a>
                    <a href="#" class="nav-item" data-view="settings">
                        <i data-lucide="settings" class="nav-icon"></i>
                        <span>Settings</span>
                    </a>
                </div>
            </nav>
            
            <div class="sidebar-footer">
                <div class="user-profile" id="userProfileBtn">
                    <div class="user-avatar">PR</div>
                    <div class="user-info">
                        <div class="user-name">Proxmox Root</div>
                        <div class="user-role">Administrator</div>
                    </div>
                    <i data-lucide="chevron-up" class="user-menu-icon"></i>
                </div>
                <div class="user-menu" id="userMenu">
                    <a href="#" class="user-menu-item" onclick="showUserProfile(event)">
                        <i data-lucide="user"></i>
                        <span>Profile</span>
                    </a>
                    <a href="#" class="user-menu-item" onclick="showView('settings')">
                        <i data-lucide="settings"></i>
                        <span>Settings</span>
                    </a>
                    <hr class="user-menu-divider">
                    <a href="#" class="user-menu-item logout" onclick="handleLogout(event)">
                        <i data-lucide="log-out"></i>
                        <span>Logout</span>
                    </a>
                </div>
            </div>
        </aside>
        
        <!-- Main Content -->
        <main class="main-content">
            <!-- Content -->
            <div class="content">
                <!-- Dashboard View -->
                <div id="dashboardView" class="view">
                    <div class="page-header">
                        <div class="page-title-row">
                            <div>
                                <h1 class="page-title">Dashboard</h1>
                                <p class="page-subtitle">Welcome back! Here's what's happening with your applications.</p>
                            </div>
                            <button class="btn btn-primary" onclick="showView('catalog')">
                                <span>âž•</span>
                                <span>Deploy New App</span>
                            </button>
                        </div>
                    </div>
                    
                    <!-- Stats Compact -->
                    <div class="stats-compact-card" id="statsGrid">
                        <div class="stat-item">
                            <div class="stat-icon primary">
                                <i data-lucide="package"></i>
                            </div>
                            <div class="stat-info">
                                <span class="stat-label">Total Applications</span>
                                <span class="stat-value" id="statTotalApps">0</span>
                            </div>
                        </div>
                        
                        <div class="stat-divider"></div>
                        
                        <div class="stat-item">
                            <div class="stat-icon success">
                                <i data-lucide="check-circle"></i>
                            </div>
                            <div class="stat-info">
                                <span class="stat-label">Running</span>
                                <span class="stat-value" id="statRunningApps">0</span>
                            </div>
                        </div>
                        
                        <div class="stat-divider"></div>
                        
                        <div class="stat-item">
                            <div class="stat-icon info">
                                <i data-lucide="server"></i>
                            </div>
                            <div class="stat-info">
                                <span class="stat-label">Infrastructure Nodes</span>
                                <span class="stat-value" id="statNodes">0</span>
                            </div>
                        </div>
                        
                        <div class="stat-divider"></div>
                        
                        <div class="stat-item">
                            <div class="stat-icon warning">
                                <i data-lucide="zap"></i>
                            </div>
                            <div class="stat-info">
                                <span class="stat-label">Resources Used</span>
                                <span class="stat-value" id="statResources">--</span>
                            </div>
                        </div>
                        
                        <div class="stat-divider"></div>
                        
                        <div class="stat-item">
                            <div class="stat-icon info">
                                <i data-lucide="globe"></i>
                            </div>
                            <div class="stat-info">
                                <span class="stat-label">Reverse Proxy</span>
                                <span class="stat-value" id="statProxyStatus">--</span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Recent Apps -->
                    <div class="apps-section">
                        <div class="section-header">
                            <h2 class="section-title">Recent Applications</h2>
                            <button class="btn btn-ghost btn-sm" onclick="showView('apps')">View All â†’</button>
                        </div>
                        <div class="apps-grid deployed" id="recentApps">
                            <div class="empty-state">
                                <div class="empty-icon">
                                    <i data-lucide="package" style="width: 48px; height: 48px;"></i>
                                </div>
                                <h3 class="empty-title">No applications yet</h3>
                                <p class="empty-message">Deploy your first application from the catalog to get started.</p>
                                <button class="btn btn-primary" onclick="showView('catalog')">Browse Catalog</button>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Apps View (Hidden by default) -->
                <div id="appsView" class="view hidden"></div>
                
                <!-- Catalog View (Hidden by default) -->
                <div id="catalogView" class="view hidden"></div>
                
                <!-- Nodes View (Hidden by default) -->
                <div id="nodesView" class="view hidden"></div>
                
                <!-- Monitoring View (Hidden by default) -->
                <div id="monitoringView" class="view hidden"></div>
                
                <!-- Settings View (Hidden by default) -->
                <div id="settingsView" class="view hidden"></div>
            </div>
        </main>
    </div>
    
    <!-- Deploy Modal -->
    <div id="deployModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title" id="modalTitle">Deploy Application</h2>
                <button class="modal-close" onclick="closeModal()">âœ•</button>
            </div>
            <div class="modal-body" id="modalBody">
                <!-- Dynamic content -->
            </div>
        </div>
    </div>

    <!-- Backup Management Modal -->
    <div id="backupModal" class="modal">
        <div class="modal-content" style="max-width: 800px;">
            <div class="modal-header">
                <h2 class="modal-title">
                    <i data-lucide="database"></i>
                    Backups for <span id="backup-app-name"></span>
                </h2>
                <button class="modal-close" onclick="hideBackupModal()">âœ•</button>
            </div>
            <div class="modal-body">
                <div class="backup-actions">
                    <button class="btn btn-primary pro-feature" onclick="createBackup()">
                        <i data-lucide="plus"></i>
                        Create New Backup
                    </button>
                </div>

                <div id="backup-list" class="backup-list">
                    <!-- Backups will be loaded here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Loading Overlay -->
    <div id="loadingOverlay" class="loading-overlay">
        <div class="loading-spinner"></div>
        <div class="loading-text" id="loadingText">Loading...</div>
    </div>

    <!-- Load legacy app.js first (non-module) -->
    <script src="app.js?v=20251008-6"></script>

    <!-- Then load modular system (ES6 modules) -->
    <script src="js/main.js?v=20251008-6" type="module"></script>

        <!-- Auth Modal (Register/Login) -->
        <div id="authModal" class="modal">
            <div class="modal-content" style="max-width: 400px;">
                <div class="modal-header">
                    <h2 class="modal-title" id="authModalTitle">Welcome to Proximity</h2>
                    <button class="modal-close" onclick="closeAuthModal()">âœ•</button>
                </div>
                <div class="modal-body" id="authModalBody">
                    <!-- Dynamic content: tabs for Register/Login -->
                </div>
            </div>
        </div>

        <!-- In-App Canvas Modal -->
        <div id="canvasModal" class="modal canvas-modal">
            <div class="canvas-modal-content">
                <div class="canvas-modal-header">
                    <div class="canvas-modal-title">
                        <i data-lucide="monitor"></i>
                        <span id="canvasAppName">Application</span>
                    </div>
                    <div class="canvas-modal-actions">
                        <button class="canvas-btn" onclick="openInNewTab()" title="Open in new tab">
                            <i data-lucide="external-link"></i>
                        </button>
                        <button class="canvas-btn" onclick="refreshCanvas()" title="Refresh">
                            <i data-lucide="refresh-cw"></i>
                        </button>
                        <button class="canvas-btn canvas-close" onclick="closeCanvas()" title="Close">
                            <i data-lucide="x"></i>
                        </button>
                    </div>
                </div>
                <div class="canvas-modal-body">
                    <div id="canvasLoading" class="canvas-loading">
                        <div class="loading-spinner"></div>
                        <div class="canvas-loading-text">Loading application...</div>
                    </div>
                    <div id="canvasError" class="canvas-error hidden">
                        <i data-lucide="alert-circle"></i>
                        <div class="canvas-error-text">
                            <h3>Unable to load application</h3>
                            <p id="canvasErrorMessage">The application could not be loaded in the canvas.</p>
                            <button class="btn btn-primary" onclick="openInNewTab()">
                                Open in New Tab
                            </button>
                        </div>
                    </div>
                    <iframe 
                        id="canvasIframe" 
                        class="canvas-iframe hidden"
                        sandbox="allow-same-origin allow-scripts allow-forms allow-popups allow-modals"
                        referrerpolicy="no-referrer-when-downgrade"
                    ></iframe>
                </div>
            </div>
        </div>

</body>
</html>
```</body>
</html>