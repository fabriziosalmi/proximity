<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Proximity - App Delivery Platform</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300..900&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&display=swap" rel="stylesheet">
            <link rel="stylesheet" href="css/styles.css?v=20251010-85">
        <link rel="stylesheet" href="/css/top-nav-rack.css?v=20251010-73">
        <link rel="stylesheet" href="/css/tablet-responsive.css?v=20251010-01">
    <!-- Xterm.js Terminal -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/xterm@5.3.0/css/xterm.css" />
    <script src="https://cdn.jsdelivr.net/npm/xterm@5.3.0/lib/xterm.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/xterm-addon-fit@0.8.0/lib/xterm-addon-fit.js"></script>

    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <!-- Top Navigation Rack -->
    <script src="/js/top-nav-rack.js?v=20251009-18"></script>

    <!-- Dynamic Submenu System -->
    <script src="/js/submenu.js?v=20251010-01"></script>

    <!-- Toast Notifications System -->
    <script src="/js/notifications-global.js?v=20251010-01"></script>

    <!-- Form Validation System -->
    <script src="/js/validation-global.js?v=20251010-01"></script>

    <!-- Load legacy app.js first (non-module) -->
    <script src="app.js?v=20251010-85"></script>

    <!-- Then load modular system (ES6 modules) -->
    <script src="js/main.js?v=20251009-51" type="module"></script>
</head>
<body>
    <!-- Power On Screen (First Run Only) -->
    <div id="power-on-screen" class="power-on-screen" style="display: none;">
        <div class="power-on-content">
            <div id="power-button" class="power-button" role="button" tabindex="0" aria-label="Initialize Proximity">
                <svg class="power-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M12 2v10"></path>
                    <path d="M18.4 6.6a9 9 0 1 1-12.77.04"></path>
                </svg>
            </div>
            <p class="power-on-text">Initialize Proximity</p>
        </div>
    </div>

    <div class="app-container">
        <!-- Top Navigation Rack -->
        <nav class="top-nav-rack">
            <div class="nav-rack-content">
                <!-- Logo Section -->
                <div class="nav-logo">
                    <span class="logo-text">Proximity</span>
                </div>
                
                <!-- Main Navigation -->
                <div class="nav-rack-items">
                    <a href="#" class="nav-rack-item active" data-view="dashboard" title="Dashboard">
                        <i data-lucide="layout-dashboard"></i>
                        <span>Dashboard</span>
                    </a>
                    <a href="#" class="nav-rack-item" data-view="apps" title="My Apps" onclick="event.preventDefault(); showAppsSubmenu();">
                        <i data-lucide="package"></i>
                        <span>Apps</span>
                        <span class="nav-badge" id="appsCount">0</span>
                    </a>
                    <a href="#" class="nav-rack-item" data-view="catalog" title="App Store" onclick="event.preventDefault(); showStoreSubmenu();">
                        <i data-lucide="store"></i>
                        <span>Store</span>
                    </a>
                    <a href="#" class="nav-rack-item" data-view="nodes" title="Hosts">
                        <i data-lucide="server"></i>
                        <span>Hosts</span>
                    </a>
                    <a href="#" class="nav-rack-item" data-view="monitoring" title="Monitoring">
                        <i data-lucide="activity"></i>
                        <span>Monitoring</span>
                    </a>
                    <a href="#" class="nav-rack-item" data-view="settings" title="Settings" onclick="event.preventDefault(); showSettingsSubmenu();">
                        <i data-lucide="settings"></i>
                        <span>Settings</span>
                    </a>
                    <a href="#" class="nav-rack-item" data-view="uilab" title="UI Lab" onclick="event.preventDefault(); showUILabSubmenu();">
                        <i data-lucide="flask-conical"></i>
                        <span>UI Lab</span>
                        <span class="nav-badge dev-badge">DEV</span>
                    </a>

                    <!-- Divider -->
                    <div class="nav-rack-divider"></div>

                    <!-- Sound Control -->
                    <button class="nav-rack-item sound-toggle-btn" id="soundToggleBtn" title="Audio Settings">
                        <i data-lucide="volume-2" id="soundIcon"></i>
                    </button>

                    <!-- Logout -->
                    <button class="nav-rack-item logout-btn" onclick="handleLogout(event)" title="Logout">
                        <i data-lucide="log-out"></i>
                    </button>
                </div>
            </div>

            <!-- Dynamic Submenu - Appears seamlessly below top bar -->
            <div class="nav-submenu" id="navSubmenu" style="display: none;">
                <div class="nav-submenu-content" id="navSubmenuContent">
                    <!-- Dynamic submenu items will be inserted here -->
                </div>
            </div>
        </nav>

        <!-- Main Content -->
        <main class="main-content">
            
            <!-- Content -->
            <div class="content">
                <!-- Dashboard View -->
                <div id="dashboardView" class="view">
                    <!-- Hero Section -->
                    <div class="hero-section">
                        <div class="hero-content">
                            <div class="hero-badge">
                                <i data-lucide="zap"></i>
                                <span>Next-Gen Application Platform</span>
                            </div>
                            <h1 class="hero-title">Welcome to Proximity</h1>
                            <p class="hero-description">
                                Deploy, manage, and scale your applications effortlessly across your Proxmox infrastructure.
                                Experience the future of container orchestration with an intuitive interface designed for developers.
                            </p>
                            <!-- Hero Stats: Hosts and Apps Count -->
                            <div class="hero-stats-inline">
                                <div class="hero-stat-compact">
                                    <i data-lucide="server"></i>
                                    <span class="hero-stat-value-inline" id="heroNodesCount">0</span>
                                    <span class="hero-stat-label-inline">Hosts</span>
                                </div>
                                <div class="hero-stat-compact">
                                    <i data-lucide="package"></i>
                                    <span class="hero-stat-value-inline" id="heroAppsCount">0</span>
                                    <span class="hero-stat-label-inline">Applications</span>
                                </div>
                            </div>

                            <!-- Quick Apps Grid Integrated -->
                            <div class="hero-apps-container">
                                <div class="hero-apps-header">
                                    <h3 class="hero-apps-title">Your Applications</h3>
                                    <button class="hero-apps-view-all" onclick="showView('apps')" title="View All Applications">
                                        <span>View All</span>
                                        <i data-lucide="arrow-right"></i>
                                    </button>
                                </div>
                                <div id="quickApps" class="hero-apps-grid">
                                    <div class="empty-state-compact">
                                        <i data-lucide="package"></i>
                                        <span>No applications deployed yet</span>
                                    </div>
                                </div>
                            </div>

                            <div class="hero-actions">
                                <button class="btn btn-primary btn-lg" onclick="showView('catalog')">
                                    <i data-lucide="rocket"></i>
                                    Deploy Your First App
                                </button>
                                <button class="btn btn-secondary btn-lg" onclick="showView('monitoring')">
                                    <i data-lucide="activity"></i>
                                    View Monitoring
                                </button>
                            </div>
                        </div>
                        <div class="hero-visual">
                            <div class="hero-grid-bg"></div>
                            <div class="hero-glow"></div>
                        </div>
                    </div>
                </div>
                
                <!-- Apps View (Hidden by default) -->
                <div id="appsView" class="view hidden"></div>
                
                <!-- Catalog View (Hidden by default) -->
                <div id="catalogView" class="view hidden"></div>
                
                <!-- Nodes View (Hidden by default) -->
                <div id="nodesView" class="view hidden"></div>
                
                <!-- Monitoring View (Hidden by default) -->
                <div id="monitoringView" class="view hidden"></div>
                
                <!-- Settings View (Hidden by default) -->
                <div id="settingsView" class="view hidden"></div>
                
                <!-- UI Lab View (Hidden by default) -->
                <div id="uilabView" class="view hidden"></div>
            </div>
        </main>
    </div>
    
    <!-- Deploy Modal -->
    <div id="deployModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title" id="modalTitle">Deploy Application</h2>
                <button class="modal-close" onclick="closeModal()">✕</button>
            </div>
            <div class="modal-body" id="modalBody">
                <!-- Dynamic content -->
            </div>
        </div>
    </div>

    <!-- Backup Management Modal -->
    <div id="backupModal" class="modal">
        <div class="modal-content" style="max-width: 800px;">
            <div class="modal-header">
                <h2 class="modal-title">
                    <i data-lucide="database"></i>
                    Backups for <span id="backup-app-name"></span>
                </h2>
                <button class="modal-close" onclick="hideBackupModal()">✕</button>
            </div>
            <div class="modal-body">
                <div class="backup-info-banner">
                    <i data-lucide="info"></i>
                    <div class="backup-info-text">
                        <strong>Protect your data with backups</strong>
                        <p>Create snapshots of your application to restore later if needed. Backups are stored on your Proxmox storage.</p>
                    </div>
                </div>
                
                <div class="backup-actions">
                    <button class="btn btn-primary" onclick="createBackup()">
                        <i data-lucide="plus"></i>
                        Create New Backup
                    </button>
                    <button class="btn btn-secondary" onclick="refreshBackups()">
                        <i data-lucide="refresh-cw"></i>
                        Refresh
                    </button>
                </div>

                <div id="backup-list" class="backup-list">
                    <div class="loading-state">
                        <div class="loading-spinner"></div>
                        <p>Loading backups...</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Loading Overlay -->
    <div id="loadingOverlay" class="loading-overlay">
        <div class="loading-spinner"></div>
        <div class="loading-text" id="loadingText">Loading...</div>
    </div>

    <!-- Toast Notification Container -->
    <div id="toast-container" class="toast-container"></div>

    <!-- ========================================
         APP CARD TEMPLATES
         ======================================== -->

    <!-- Deployed App Card Template -->
    <template id="deployed-app-card-template">
        <div class="app-card deployed">
            <!-- Header: Icon, Name, Quick Actions -->
            <div class="app-card-header">
                <div class="app-icon-lg"></div>
                <div class="app-info">
                    <h3 class="app-name"></h3>
                </div>

                <!-- Quick Actions -->
                <div class="app-quick-actions">
                    <button class="action-icon" data-action="toggle-status" title="">
                        <i data-lucide="play"></i>
                    </button>
                    <button class="action-icon" data-action="open-external" title="Open in new tab">
                        <i data-lucide="external-link"></i>
                    </button>
                    <button class="action-icon" data-action="view-logs" title="View logs">
                        <i data-lucide="file-text"></i>
                    </button>
                    <button class="action-icon" data-action="console" title="Console">
                        <i data-lucide="terminal"></i>
                    </button>
                    <button class="action-icon" data-action="backups" title="Backups">
                        <i data-lucide="database"></i>
                    </button>
                    <button class="action-icon" data-action="update" title="Update Application">
                        <i data-lucide="arrow-up-circle"></i>
                    </button>
                    <button class="action-icon" data-action="volumes" title="View Volumes">
                        <i data-lucide="hard-drive"></i>
                    </button>
                    <button class="action-icon" data-action="monitoring" title="Monitoring">
                        <i data-lucide="activity"></i>
                    </button>
                    <button class="action-icon" data-action="canvas" title="Open in Canvas" style="display: none;">
                        <i data-lucide="monitor"></i>
                    </button>
                    <button class="action-icon" data-action="restart" title="Restart">
                        <i data-lucide="refresh-cw"></i>
                    </button>
                    <button class="action-icon pro-feature" data-action="clone" title="Clone App">
                        <i data-lucide="copy"></i>
                    </button>
                    <button class="action-icon pro-feature" data-action="edit-config" title="Edit Resources">
                        <i data-lucide="sliders"></i>
                    </button>
                    <button class="action-icon danger" data-action="delete" title="Delete">
                        <i data-lucide="trash-2"></i>
                    </button>
                </div>
            </div>

            <!-- Connection Info: Status, URL, Node, Container, Date -->
            <div class="app-connection-info">
                <div class="connection-item">
                    <span class="status-badge-compact">
                        <span class="status-dot-small"></span>
                        <span class="status-text"></span>
                    </span>
                </div>
                <div class="connection-item">
                    <i data-lucide="link" class="connection-icon"></i>
                    <a href="#" target="_blank" class="connection-value connection-link"></a>
                </div>
                <div class="connection-item">
                    <i data-lucide="server" class="connection-icon"></i>
                    <span class="connection-value node-value"></span>
                </div>
                <div class="connection-item">
                    <i data-lucide="box" class="connection-icon"></i>
                    <span class="connection-value lxc-id-value"></span>
                </div>
                <div class="connection-item">
                    <i data-lucide="clock" class="connection-icon"></i>
                    <span class="connection-value date-value"></span>
                </div>
            </div>
        </div>
    </template>

    <!-- Catalog App Card Template -->
    <template id="catalog-app-card-template">
        <div class="app-card catalog-card">
            <div class="catalog-card-content">
                <div class="app-icon-md"></div>
                <div class="catalog-info">
                    <div class="catalog-header">
                        <h3 class="app-name"></h3>
                        <span class="category-badge"></span>
                    </div>
                    <p class="app-description-compact"></p>
                    <div class="catalog-meta">
                        <span class="meta-badge">
                            <i data-lucide="cpu"></i>
                            <span class="cpu-value"></span>
                        </span>
                        <span class="meta-badge">
                            <i data-lucide="database"></i>
                            <span class="memory-value"></span>
                        </span>
                    </div>
                </div>
            </div>
        </div>
    </template>

        <!-- Auth Modal (Register/Login) -->
        <div id="authModal" class="modal">
            <div class="modal-content" style="max-width: 400px;">
                <div class="modal-header">
                    <h2 class="modal-title" id="authModalTitle">Welcome to Proximity</h2>
                    <button class="modal-close" onclick="closeAuthModal()">✕</button>
                </div>
                <div class="modal-body" id="authModalBody">
                    <!-- Dynamic content: tabs for Register/Login -->
                </div>
            </div>
        </div>

        <!-- In-App Canvas Modal -->
        <div id="canvasModal" class="modal canvas-modal">
            <div class="canvas-modal-content">
                <div class="canvas-modal-header">
                    <div class="canvas-modal-title">
                        <i data-lucide="monitor"></i>
                        <span id="canvasAppName">Application</span>
                    </div>
                    <div class="canvas-modal-actions">
                        <button class="canvas-btn" onclick="toggleCanvasHeader()" title="Minimize/Maximize header">
                            <i data-lucide="minimize-2" id="canvasHeaderToggleIcon"></i>
                        </button>
                        <button class="canvas-btn" onclick="openInNewTab()" title="Open in new tab">
                            <i data-lucide="external-link"></i>
                        </button>
                        <button class="canvas-btn" onclick="refreshCanvas()" title="Refresh">
                            <i data-lucide="refresh-cw"></i>
                        </button>
                        <button class="canvas-btn canvas-close" onclick="closeCanvas()" title="Close">
                            <i data-lucide="x"></i>
                        </button>
                    </div>
                </div>
                <div class="canvas-modal-body">
                    <div id="canvasLoading" class="canvas-loading">
                        <div class="loading-spinner"></div>
                        <div class="canvas-loading-text">Loading application...</div>
                    </div>
                    <div id="canvasError" class="canvas-error hidden">
                        <i data-lucide="alert-circle"></i>
                        <div class="canvas-error-text">
                            <h3>Unable to load application</h3>
                            <p id="canvasErrorMessage">The application could not be loaded in the canvas.</p>
                            <button class="btn btn-primary" onclick="openInNewTab()">
                                Open in New Tab
                            </button>
                        </div>
                    </div>
                    <iframe 
                        id="canvasIframe" 
                        class="canvas-iframe hidden"
                        sandbox="allow-same-origin allow-scripts allow-forms allow-popups allow-modals allow-popups-to-escape-sandbox allow-downloads allow-storage-access-by-user-activation"
                        referrerpolicy="no-referrer-when-downgrade"
                        allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; fullscreen"
                        loading="eager"
                        importance="high"
                    ></iframe>
                </div>
            </div>
        </div>

</body>
</html>