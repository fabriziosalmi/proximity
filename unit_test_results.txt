/opt/homebrew/lib/python3.13/site-packages/pytest_asyncio/plugin.py:208: PytestDeprecationWarning: The configuration option "asyncio_default_fixture_loop_scope" is unset.
The event loop scope for asynchronous fixtures will default to the fixture caching scope. Future versions of pytest-asyncio will default the loop scope for asynchronous fixtures to function scope. Set the default fixture loop scope explicitly in order to avoid unexpected behavior in the future. Valid fixture loop scopes are: "function", "class", "module", "package", "session"

  warnings.warn(PytestDeprecationWarning(_DEFAULT_FIXTURE_LOOP_SCOPE_UNSET))
============================= test session starts ==============================
platform darwin -- Python 3.13.7, pytest-8.3.4, pluggy-1.5.0 -- /opt/homebrew/opt/python@3.13/bin/python3.13
cachedir: .pytest_cache
rootdir: /Users/fab/GitHub/proximity
configfile: pytest.ini
plugins: xdist-3.8.0, timeout-2.4.0, anyio-4.8.0, cov-6.2.1, mock-3.14.1, rerunfailures-16.0.1, base-url-2.1.0, playwright-0.7.1, asyncio-1.0.0, Faker-33.3.1, requests-mock-1.12.1
asyncio: mode=Mode.STRICT, asyncio_default_fixture_loop_scope=None, asyncio_default_test_loop_scope=function
collecting ... collected 259 items

tests/test_api_endpoints.py::TestHealthEndpoints::test_health_check PASSED [  0%]
tests/test_api_endpoints.py::TestHealthEndpoints::test_api_root PASSED   [  0%]
tests/test_api_endpoints.py::TestAuthEndpoints::test_register_user_success PASSED [  1%]
tests/test_api_endpoints.py::TestAuthEndpoints::test_register_duplicate_user PASSED [  1%]
tests/test_api_endpoints.py::TestAuthEndpoints::test_login_success PASSED [  1%]
tests/test_api_endpoints.py::TestAuthEndpoints::test_login_wrong_password PASSED [  2%]
tests/test_api_endpoints.py::TestAuthEndpoints::test_get_current_user PASSED [  2%]
tests/test_api_endpoints.py::TestAuthEndpoints::test_get_current_user_unauthorized PASSED [  3%]
tests/test_api_endpoints.py::TestAuthEndpoints::test_logout PASSED       [  3%]
tests/test_api_endpoints.py::TestSystemEndpoints::test_get_system_info PASSED [  3%]
tests/test_api_endpoints.py::TestSystemEndpoints::test_get_nodes PASSED  [  4%]
tests/test_api_endpoints.py::TestSystemEndpoints::test_get_system_info_unauthorized PASSED [  4%]
tests/test_api_endpoints.py::TestAppEndpoints::test_get_catalog PASSED   [  5%]
tests/test_api_endpoints.py::TestAppEndpoints::test_list_apps PASSED     [  5%]
tests/test_api_endpoints.py::TestAppEndpoints::test_list_apps_unauthorized PASSED [  5%]
tests/test_api_endpoints.py::TestAppEndpoints::test_deploy_app PASSED    [  6%]
tests/test_api_endpoints.py::TestSettingsEndpoints::test_get_proxmox_settings_unauthorized PASSED [  6%]
tests/test_api_endpoints.py::TestSettingsEndpoints::test_get_proxmox_settings_admin PASSED [  6%]
tests/test_api_endpoints.py::TestCORSAndOptions::test_options_request PASSED [  7%]
tests/test_api_endpoints.py::TestCORSAndOptions::test_cors_headers PASSED [  7%]
tests/test_app_clone_config.py::TestCloneApp::test_clone_app_success FAILED [  8%]
tests/test_app_clone_config.py::TestCloneApp::test_clone_app_source_not_found FAILED [  8%]
tests/test_app_clone_config.py::TestCloneApp::test_clone_app_duplicate_hostname FAILED [  8%]
tests/test_app_clone_config.py::TestCloneApp::test_clone_app_proxmox_failure_cleanup PASSED [  9%]
tests/test_app_clone_config.py::TestCloneApp::test_clone_app_copies_all_properties FAILED [  9%]
tests/test_app_clone_config.py::TestUpdateAppConfig::test_update_cpu_cores FAILED [ 10%]
tests/test_app_clone_config.py::TestUpdateAppConfig::test_update_memory FAILED [ 10%]
tests/test_app_clone_config.py::TestUpdateAppConfig::test_update_disk_size FAILED [ 10%]
tests/test_app_clone_config.py::TestUpdateAppConfig::test_update_multiple_resources FAILED [ 11%]
tests/test_app_clone_config.py::TestUpdateAppConfig::test_update_no_parameters_raises_error PASSED [ 11%]
tests/test_app_clone_config.py::TestUpdateAppConfig::test_update_app_not_found FAILED [ 11%]
tests/test_app_clone_config.py::TestUpdateAppConfig::test_update_stopped_app_no_restart PASSED [ 12%]
tests/test_app_clone_config.py::TestUpdateAppConfig::test_update_failure_attempts_restart FAILED [ 12%]
tests/test_app_service.py::TestAppService::test_get_catalog PASSED       [ 13%]
tests/test_app_service.py::TestAppService::test_get_catalog_item PASSED  [ 13%]
tests/test_app_service.py::TestAppService::test_get_all_apps_empty PASSED [ 13%]
tests/test_app_service.py::TestAppService::test_deploy_app_success PASSED [ 14%]
tests/test_app_service.py::TestAppService::test_get_app_success PASSED   [ 14%]
tests/test_app_service.py::TestAppService::test_get_app_not_found PASSED [ 15%]
tests/test_app_service.py::TestAppService::test_start_app PASSED         [ 15%]
tests/test_app_service.py::TestAppService::test_stop_app PASSED          [ 15%]
tests/test_app_service.py::TestAppService::test_restart_app PASSED       [ 16%]
tests/test_app_service.py::TestAppService::test_delete_app_success PASSED [ 16%]
tests/test_app_service.py::TestAppService::test_deployment_with_proxy PASSED [ 16%]
tests/test_app_service.py::TestAppService::test_deployment_cleanup_on_failure PASSED [ 17%]
tests/test_app_service.py::TestAppServiceUpdate::test_update_app_creates_pre_update_backup PASSED [ 17%]
tests/test_app_service.py::TestAppServiceUpdate::test_update_app_aborts_if_backup_fails PASSED [ 18%]
tests/test_app_service.py::TestAppServiceUpdate::test_update_app_runs_pull_and_up_commands PASSED [ 18%]
tests/test_app_service.py::TestAppServiceUpdate::test_update_app_handles_failed_health_check PASSED [ 18%]
tests/test_app_service.py::TestAppServiceCatalog::test_catalog_loads_from_files PASSED [ 19%]
tests/test_app_service.py::TestAppServiceCatalog::test_catalog_item_has_required_fields PASSED [ 19%]
tests/test_auth_service.py::TestAuthService::test_create_access_token PASSED [ 20%]
tests/test_auth_service.py::TestAuthService::test_verify_token_success PASSED [ 20%]
tests/test_auth_service.py::TestAuthService::test_verify_token_expired PASSED [ 20%]
tests/test_auth_service.py::TestAuthService::test_verify_token_invalid PASSED [ 21%]
tests/test_auth_service.py::TestAuthService::test_authenticate_user_success PASSED [ 21%]
tests/test_auth_service.py::TestAuthService::test_authenticate_user_wrong_password PASSED [ 22%]
tests/test_auth_service.py::TestAuthService::test_authenticate_user_not_found PASSED [ 22%]
tests/test_auth_service.py::TestAuthService::test_authenticate_inactive_user PASSED [ 22%]
tests/test_auth_service.py::TestAuthService::test_create_user_success PASSED [ 23%]
tests/test_auth_service.py::TestAuthService::test_create_user_duplicate_username PASSED [ 23%]
tests/test_auth_service.py::TestAuthService::test_create_user_duplicate_email PASSED [ 23%]
tests/test_auth_service.py::TestAuthService::test_create_user_without_email PASSED [ 24%]
tests/test_auth_service.py::TestAuthService::test_change_password_success PASSED [ 24%]
tests/test_auth_service.py::TestAuthService::test_change_password_wrong_old_password PASSED [ 25%]
tests/test_auth_service.py::TestAuthService::test_log_audit PASSED       [ 25%]
tests/test_auth_service.py::TestPasswordHashing::test_hash_password PASSED [ 25%]
tests/test_auth_service.py::TestPasswordHashing::test_verify_password_correct PASSED [ 26%]
tests/test_auth_service.py::TestPasswordHashing::test_verify_password_incorrect PASSED [ 26%]
tests/test_auth_service.py::TestPasswordHashing::test_password_hash_unique PASSED [ 27%]
tests/test_auth_service.py::TestTokenDataExtraction::test_token_contains_all_fields PASSED [ 27%]
tests/test_auth_service.py::TestTokenDataExtraction::test_token_missing_fields PASSED [ 27%]
tests/test_backup_api.py::TestBackupAPICreate::test_create_backup_success PASSED [ 28%]
tests/test_backup_api.py::TestBackupAPICreate::test_create_backup_unauthorized PASSED [ 28%]
tests/test_backup_api.py::TestBackupAPICreate::test_create_backup_app_not_found PASSED [ 28%]
tests/test_backup_api.py::TestBackupAPICreate::test_create_backup_invalid_compression PASSED [ 29%]
tests/test_backup_api.py::TestBackupAPIList::test_list_backups_success PASSED [ 29%]
tests/test_backup_api.py::TestBackupAPIList::test_list_backups_empty PASSED [ 30%]
tests/test_backup_api.py::TestBackupAPIList::test_list_backups_app_not_found PASSED [ 30%]
tests/test_backup_api.py::TestBackupAPIGet::test_get_backup_success PASSED [ 30%]
tests/test_backup_api.py::TestBackupAPIGet::test_get_backup_not_found PASSED [ 31%]
tests/test_backup_api.py::TestBackupAPIRestore::test_restore_backup_success PASSED [ 31%]
tests/test_backup_api.py::TestBackupAPIRestore::test_restore_backup_not_available PASSED [ 32%]
tests/test_backup_api.py::TestBackupAPIDelete::test_delete_backup_success PASSED [ 32%]
tests/test_backup_api.py::TestBackupAPIDelete::test_delete_backup_not_found PASSED [ 32%]
tests/test_backup_api.py::TestBackupAPIPermissions::test_user_can_only_access_own_backups PASSED [ 33%]
tests/test_backup_model.py::TestBackupModel::test_create_backup PASSED   [ 33%]
tests/test_backup_model.py::TestBackupModel::test_backup_app_relationship PASSED [ 33%]
tests/test_backup_model.py::TestBackupModel::test_backup_cascade_delete PASSED [ 34%]
tests/test_backup_model.py::TestBackupModel::test_backup_status_transitions PASSED [ 34%]
tests/test_backup_model.py::TestBackupModel::test_backup_with_error PASSED [ 35%]
tests/test_backup_model.py::TestBackupModel::test_backup_requires_app_id PASSED [ 35%]
tests/test_backup_model.py::TestBackupModel::test_backup_requires_filename PASSED [ 35%]
tests/test_backup_model.py::TestBackupModel::test_backup_requires_status PASSED [ 36%]
tests/test_backup_model.py::TestBackupModel::test_backup_default_storage_name PASSED [ 36%]
tests/test_backup_model.py::TestBackupModel::test_backup_default_backup_type PASSED [ 37%]
tests/test_backup_model.py::TestBackupModel::test_multiple_backups_for_app PASSED [ 37%]
tests/test_backup_model.py::TestBackupModel::test_backup_representation PASSED [ 37%]
tests/test_backup_model.py::TestBackupModel::test_backup_foreign_key_constraint PASSED [ 38%]
tests/test_backup_model.py::TestBackupModel::test_backup_query_by_status PASSED [ 38%]
tests/test_backup_model.py::TestBackupModel::test_backup_order_by_created_at PASSED [ 38%]
tests/test_backup_service.py::TestBackupServiceCreate::test_create_backup_success PASSED [ 39%]
tests/test_backup_service.py::TestBackupServiceCreate::test_create_backup_app_not_found PASSED [ 39%]
tests/test_backup_service.py::TestBackupServiceCreate::test_create_backup_proxmox_failure PASSED [ 40%]
tests/test_backup_service.py::TestBackupServiceCreate::test_create_backup_with_custom_compression PASSED [ 40%]
tests/test_backup_service.py::TestBackupServiceList::test_list_backups_for_app PASSED [ 40%]
tests/test_backup_service.py::TestBackupServiceList::test_list_backups_empty PASSED [ 41%]
tests/test_backup_service.py::TestBackupServiceList::test_list_backups_ordered_by_created_at PASSED [ 41%]
tests/test_backup_service.py::TestBackupServiceGet::test_get_backup_success PASSED [ 42%]
tests/test_backup_service.py::TestBackupServiceGet::test_get_backup_not_found PASSED [ 42%]
tests/test_backup_service.py::TestBackupServiceRestore::test_restore_backup_success PASSED [ 42%]
tests/test_backup_service.py::TestBackupServiceRestore::test_restore_backup_not_available PASSED [ 43%]
tests/test_backup_service.py::TestBackupServiceRestore::test_restore_failure_restarts_container PASSED [ 43%]
tests/test_backup_service.py::TestBackupServiceDelete::test_delete_backup_success PASSED [ 44%]
tests/test_backup_service.py::TestBackupServiceDelete::test_delete_backup_not_found PASSED [ 44%]
tests/test_backup_service.py::TestBackupServicePolling::test_poll_backup_completion_success PASSED [ 44%]
tests/test_backup_service.py::TestBackupServicePolling::test_poll_backup_completion_failed PASSED [ 45%]
tests/test_catalog_service.py::TestCatalogLoading::test_load_catalog_from_individual_files PASSED [ 45%]
tests/test_catalog_service.py::TestCatalogLoading::test_load_catalog_with_default_items PASSED [ 45%]
tests/test_catalog_service.py::TestCatalogLoading::test_catalog_caching PASSED [ 46%]
tests/test_catalog_service.py::TestCatalogLoading::test_get_catalog_item_by_id PASSED [ 46%]
tests/test_catalog_service.py::TestCatalogLoading::test_get_nonexistent_catalog_item PASSED [ 47%]
tests/test_catalog_service.py::TestCatalogItems::test_catalog_item_has_required_fields PASSED [ 47%]
tests/test_catalog_service.py::TestCatalogItems::test_catalog_categories PASSED [ 47%]
tests/test_catalog_service.py::TestCatalogItems::test_catalog_docker_compose_format PASSED [ 48%]
tests/test_catalog_service.py::TestCatalogItems::test_catalog_ports_format PASSED [ 48%]
tests/test_catalog_service.py::TestCatalogItems::test_catalog_resource_requirements PASSED [ 49%]
tests/test_catalog_service.py::TestCatalogFiltering::test_filter_by_category PASSED [ 49%]
tests/test_catalog_service.py::TestCatalogFiltering::test_search_by_name PASSED [ 49%]
tests/test_catalog_service.py::TestCatalogEnvironmentVariables::test_catalog_default_environment PASSED [ 50%]
tests/test_catalog_service.py::TestCatalogEnvironmentVariables::test_merge_environment_variables PASSED [ 50%]
tests/test_catalog_service.py::TestCatalogVersioning::test_catalog_item_version PASSED [ 50%]
tests/test_catalog_service.py::TestCatalogErrorHandling::test_invalid_catalog_json PASSED [ 51%]
tests/test_catalog_service.py::TestCatalogErrorHandling::test_missing_catalog_file PASSED [ 51%]
tests/test_catalog_service.py::TestCatalogTotalCount::test_total_matches_items_count PASSED [ 52%]
tests/test_database_models.py::TestUserModel::test_create_user PASSED    [ 52%]
tests/test_database_models.py::TestUserModel::test_user_unique_username PASSED [ 52%]
tests/test_database_models.py::TestUserModel::test_user_unique_email PASSED [ 53%]
tests/test_database_models.py::TestUserModel::test_user_password_hashing PASSED [ 53%]
tests/test_database_models.py::TestUserModel::test_user_password_verification PASSED [ 54%]
tests/test_database_models.py::TestUserModel::test_user_without_email PASSED [ 54%]
tests/test_database_models.py::TestUserModel::test_user_role_default PASSED [ 54%]
tests/test_database_models.py::TestUserModel::test_user_is_active_default PASSED [ 55%]
tests/test_database_models.py::TestUserModel::test_user_representation PASSED [ 55%]
tests/test_database_models.py::TestAppModel::test_create_app PASSED      [ 55%]
tests/test_database_models.py::TestAppModel::test_app_unique_hostname PASSED [ 56%]
tests/test_database_models.py::TestAppModel::test_app_unique_lxc_id PASSED [ 56%]
tests/test_database_models.py::TestAppModel::test_app_without_owner PASSED [ 57%]
tests/test_database_models.py::TestAppModel::test_app_user_relationship PASSED [ 57%]
tests/test_database_models.py::TestAppModel::test_app_cascade_delete_logs PASSED [ 57%]
tests/test_database_models.py::TestAppModel::test_app_json_fields_default PASSED [ 58%]
tests/test_database_models.py::TestAppModel::test_app_updated_at_auto_update PASSED [ 58%]
tests/test_database_models.py::TestAppModel::test_app_representation PASSED [ 59%]
tests/test_database_models.py::TestDeploymentLogModel::test_create_deployment_log PASSED [ 59%]
tests/test_database_models.py::TestDeploymentLogModel::test_deployment_log_levels PASSED [ 59%]
tests/test_database_models.py::TestDeploymentLogModel::test_deployment_log_app_relationship PASSED [ 60%]
tests/test_database_models.py::TestDeploymentLogModel::test_deployment_log_representation PASSED [ 60%]
tests/test_database_models.py::TestAuditLogModel::test_create_audit_log PASSED [ 61%]
tests/test_database_models.py::TestAuditLogModel::test_audit_log_without_user PASSED [ 61%]
tests/test_database_models.py::TestAuditLogModel::test_audit_log_actions PASSED [ 61%]
tests/test_database_models.py::TestAuditLogModel::test_audit_log_representation PASSED [ 62%]
tests/test_database_models.py::TestDatabaseConstraints::test_cascade_delete_user_apps PASSED [ 62%]
tests/test_database_models.py::TestDatabaseConstraints::test_app_requires_catalog_id PASSED [ 62%]
tests/test_database_models.py::TestDatabaseConstraints::test_app_requires_lxc_id PASSED [ 63%]
tests/test_database_transactions.py::TestTransactionAtomicity::test_deploy_app_rollback_on_proxmox_error PASSED [ 63%]
tests/test_database_transactions.py::TestTransactionAtomicity::test_delete_app_rollback_on_error PASSED [ 64%]
tests/test_database_transactions.py::TestTransactionIsolation::test_concurrent_user_creation PASSED [ 64%]
tests/test_database_transactions.py::TestTransactionIsolation::test_app_hostname_uniqueness_enforced PASSED [ 64%]
tests/test_database_transactions.py::TestTransactionIsolation::test_lxc_id_uniqueness_enforced PASSED [ 65%]
tests/test_database_transactions.py::TestTransactionConsistency::test_app_status_consistency PASSED [ 65%]
tests/test_database_transactions.py::TestTransactionConsistency::test_app_status_consistency_on_error PASSED [ 66%]
tests/test_database_transactions.py::TestTransactionConsistency::test_user_cascade_delete_consistency PASSED [ 66%]
tests/test_database_transactions.py::TestTransactionDurability::test_deployed_app_persists PASSED [ 66%]
tests/test_database_transactions.py::TestTransactionDurability::test_updated_app_status_persists PASSED [ 67%]
tests/test_database_transactions.py::TestTransactionDurability::test_deleted_app_removal_persists PASSED [ 67%]
tests/test_database_transactions.py::TestMultipleOperations::test_deploy_start_stop_delete_sequence PASSED [ 67%]
tests/test_database_transactions.py::TestMultipleOperations::test_multiple_apps_independent_transactions PASSED [ 68%]
tests/test_database_transactions.py::TestRollbackScenarios::test_rollback_reverts_changes PASSED [ 68%]
tests/test_database_transactions.py::TestRollbackScenarios::test_rollback_after_integrity_error PASSED [ 69%]
tests/test_error_handling.py::TestAuthenticationErrors::test_login_with_invalid_credentials PASSED [ 69%]
tests/test_error_handling.py::TestAuthenticationErrors::test_login_with_inactive_user PASSED [ 69%]
tests/test_error_handling.py::TestAuthenticationErrors::test_register_with_duplicate_username PASSED [ 70%]
tests/test_error_handling.py::TestAuthenticationErrors::test_register_with_duplicate_email PASSED [ 70%]
tests/test_error_handling.py::TestAuthenticationErrors::test_access_protected_route_without_token PASSED [ 71%]
tests/test_error_handling.py::TestAuthenticationErrors::test_access_protected_route_with_invalid_token PASSED [ 71%]
tests/test_error_handling.py::TestAuthenticationErrors::test_access_protected_route_with_expired_token PASSED [ 71%]
tests/test_error_handling.py::TestAuthenticationErrors::test_password_change_with_wrong_old_password PASSED [ 72%]
tests/test_error_handling.py::TestAppServiceErrors::test_get_nonexistent_app PASSED [ 72%]
tests/test_error_handling.py::TestAppServiceErrors::test_deploy_app_with_duplicate_id PASSED [ 72%]
tests/test_error_handling.py::TestAppServiceErrors::test_deploy_app_with_invalid_catalog_id PASSED [ 73%]
tests/test_error_handling.py::TestAppServiceErrors::test_start_app_proxmox_failure PASSED [ 73%]
tests/test_error_handling.py::TestAppServiceErrors::test_stop_app_proxmox_failure PASSED [ 74%]
tests/test_error_handling.py::TestAppServiceErrors::test_delete_nonexistent_app PASSED [ 74%]
tests/test_error_handling.py::TestAppServiceErrors::test_deployment_with_network_failure PASSED [ 74%]
tests/test_error_handling.py::TestProxmoxServiceErrors::test_connection_failure PASSED [ 75%]
tests/test_error_handling.py::TestProxmoxServiceErrors::test_lxc_creation_failure PASSED [ 75%]
tests/test_error_handling.py::TestProxmoxServiceErrors::test_lxc_start_failure PASSED [ 76%]
tests/test_error_handling.py::TestAPIEndpointErrors::test_invalid_json_payload PASSED [ 76%]
tests/test_error_handling.py::TestAPIEndpointErrors::test_missing_required_fields PASSED [ 76%]
tests/test_error_handling.py::TestAPIEndpointErrors::test_invalid_field_types PASSED [ 77%]
tests/test_error_handling.py::TestAPIEndpointErrors::test_admin_only_endpoint_as_user PASSED [ 77%]
tests/test_error_handling.py::TestAPIEndpointErrors::test_nonexistent_endpoint PASSED [ 77%]
tests/test_error_handling.py::TestEdgeCases::test_very_long_username PASSED [ 78%]
tests/test_error_handling.py::TestEdgeCases::test_empty_password PASSED  [ 78%]
tests/test_error_handling.py::TestEdgeCases::test_special_characters_in_hostname PASSED [ 79%]
tests/test_error_handling.py::TestEdgeCases::test_very_large_config_json PASSED [ 79%]
tests/test_error_handling.py::TestEdgeCases::test_null_values_in_optional_fields PASSED [ 79%]
tests/test_error_handling.py::TestEdgeCases::test_concurrent_deployments_same_hostname PASSED [ 80%]
tests/test_error_handling.py::TestEdgeCases::test_unicode_in_app_name PASSED [ 80%]
tests/test_error_handling.py::TestEdgeCases::test_max_vmid_value PASSED  [ 81%]
tests/test_integration.py::TestFullDeploymentWorkflow::test_complete_app_lifecycle PASSED [ 81%]
tests/test_integration.py::TestAuthenticationWorkflow::test_register_login_access_logout PASSED [ 81%]
tests/test_integration.py::TestCatalogBrowsing::test_browse_catalog_and_get_details PASSED [ 82%]
tests/test_integration.py::TestSystemMonitoring::test_monitor_system_resources PASSED [ 82%]
tests/test_integration.py::TestErrorHandling::test_authentication_errors PASSED [ 83%]
tests/test_integration.py::TestErrorHandling::test_resource_not_found PASSED [ 83%]
tests/test_integration.py::TestErrorHandling::test_invalid_input PASSED  [ 83%]
tests/test_integration.py::TestCORS::test_cors_preflight PASSED          [ 84%]
tests/test_integration.py::TestCORS::test_cors_headers_present PASSED    [ 84%]
tests/test_integration.py::TestDataConsistency::test_user_data_consistency PASSED [ 84%]
tests/test_monitoring_service.py::TestMonitoringService::test_get_current_app_stats_success PASSED [ 85%]
tests/test_monitoring_service.py::TestMonitoringService::test_get_current_app_stats_uses_cache PASSED [ 85%]
tests/test_monitoring_service.py::TestMonitoringService::test_get_current_app_stats_cache_expires PASSED [ 86%]
tests/test_monitoring_service.py::TestMonitoringService::test_get_current_app_stats_handles_proxmox_error PASSED [ 86%]
tests/test_monitoring_service.py::TestMonitoringService::test_clear_cache_single_entry PASSED [ 86%]
tests/test_monitoring_service.py::TestMonitoringService::test_clear_cache_all_entries PASSED [ 87%]
tests/test_monitoring_service.py::TestMonitoringService::test_get_cache_stats PASSED [ 87%]
tests/test_monitoring_service.py::TestMonitoringService::test_concurrent_requests_same_app PASSED [ 88%]
tests/test_monitoring_service.py::TestMonitoringService::test_zero_values_handled_correctly PASSED [ 88%]
tests/test_port_manager.py::TestPortManagerService::test_assign_first_ports PASSED [ 88%]
tests/test_port_manager.py::TestPortManagerService::test_sequential_port_allocation PASSED [ 89%]
tests/test_port_manager.py::TestPortManagerService::test_skip_used_ports PASSED [ 89%]
tests/test_port_manager.py::TestPortManagerService::test_release_ports_for_app PASSED [ 89%]
tests/test_port_manager.py::TestPortManagerService::test_release_ports_nonexistent_app PASSED [ 90%]
tests/test_port_manager.py::TestPortManagerService::test_get_port_usage_stats PASSED [ 90%]
tests/test_port_manager.py::TestPortManagerService::test_port_exhaustion_error PASSED [ 91%]
tests/test_port_manager.py::TestPortManagerService::test_multiple_apps_unique_ports PASSED [ 91%]
tests/test_port_manager.py::TestPortManagerService::test_ports_not_reused_immediately PASSED [ 91%]
tests/test_proxmox_service.py::TestProxmoxService::test_connection_success PASSED [ 92%]
tests/test_proxmox_service.py::TestProxmoxService::test_get_nodes FAILED [ 92%]
tests/test_proxmox_service.py::TestProxmoxService::test_get_next_vmid PASSED [ 93%]
tests/test_proxmox_service.py::TestProxmoxService::test_create_lxc_success PASSED [ 93%]
tests/test_proxmox_service.py::TestProxmoxService::test_start_lxc PASSED [ 93%]
tests/test_proxmox_service.py::TestProxmoxService::test_stop_lxc PASSED  [ 94%]
tests/test_proxmox_service.py::TestProxmoxService::test_destroy_lxc PASSED [ 94%]
tests/test_proxmox_service.py::TestProxmoxService::test_get_lxc_status PASSED [ 94%]
tests/test_proxmox_service.py::TestProxmoxService::test_connection_failure PASSED [ 95%]
tests/test_proxmox_service.py::TestProxmoxService::test_lxc_already_exists PASSED [ 95%]
tests/test_proxmox_service.py::TestProxmoxServiceSSH::test_execute_in_container PASSED [ 96%]
tests/test_proxmox_service.py::TestProxmoxServiceSSH::test_setup_docker_in_alpine PASSED [ 96%]
tests/test_proxmox_service.py::TestProxmoxServiceNetwork::test_get_lxc_ip PASSED [ 96%]
tests/test_proxmox_service.py::TestProxmoxServiceNetwork::test_network_config_creation PASSED [ 97%]
tests/test_reverse_proxy_manager.py::TestReverseProxyManagerCaddyConfig::test_generate_caddy_config_port_based PASSED [ 97%]
tests/test_reverse_proxy_manager.py::TestReverseProxyManagerCaddyConfig::test_generate_caddy_config_different_ports PASSED [ 98%]
tests/test_reverse_proxy_manager.py::TestReverseProxyManagerCaddyConfig::test_header_stripping_is_specific_to_iframe_port PASSED [ 98%]
tests/test_reverse_proxy_manager.py::TestReverseProxyManagerCaddyConfig::test_config_includes_proxy_headers PASSED [ 98%]
tests/test_reverse_proxy_manager.py::TestReverseProxyManagerCaddyConfig::test_config_format_is_valid_caddyfile_syntax PASSED [ 99%]
tests/test_reverse_proxy_manager.py::TestReverseProxyManagerCaddyConfig::test_multiple_apps_have_unique_ports PASSED [ 99%]
tests/test_reverse_proxy_manager.py::TestReverseProxyManagerCaddyConfig::test_port_based_urls_generation PASSED [100%]

=================================== FAILURES ===================================
_____________________ TestCloneApp.test_clone_app_success ______________________
tests/test_app_clone_config.py:139: in test_clone_app_success
    assert cloned_app.volumes == source_app.volumes  # Volumes copied
E   AssertionError: assert ['/data/nginx...e/nginx/html'] == [{'container_.../data/nginx'}]
E     
E     At index 0 diff: '/data/nginx:/usr/share/nginx/html' != {'host_path': '/data/nginx', 'container_path': '/usr/share/nginx/html'}
E     
E     Full diff:
E       [
E     +     '/data/nginx:/usr/share/nginx/html',
E     -     {...
E     
E     ...Full output truncated (4 lines hidden), use '-vv' to show
_________________ TestCloneApp.test_clone_app_source_not_found _________________
tests/test_app_clone_config.py:156: in test_clone_app_source_not_found
    await app_service.clone_app("nonexistent-app", "new-hostname")
backend/services/app_service.py:681: in clone_app
    source_app = await self.get_app(source_app_id)
backend/services/app_service.py:321: in get_app
    raise AppServiceError(f"App '{app_id}' not found")
E   services.app_service.AppServiceError: App 'nonexistent-app' not found
________________ TestCloneApp.test_clone_app_duplicate_hostname ________________
/opt/homebrew/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
/opt/homebrew/lib/python3.13/site-packages/sqlalchemy/engine/default.py:951: in do_execute
    cursor.execute(statement, parameters)
E   sqlite3.IntegrityError: UNIQUE constraint failed: apps.hostname

The above exception was the direct cause of the following exception:
backend/services/app_service.py:798: in clone_app
    self.db.commit()
/opt/homebrew/lib/python3.13/site-packages/sqlalchemy/orm/session.py:2032: in commit
    trans.commit(_to_root=True)
/opt/homebrew/lib/python3.13/site-packages/sqlalchemy/orm/state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
/opt/homebrew/lib/python3.13/site-packages/sqlalchemy/orm/session.py:1313: in commit
    self._prepare_impl()
/opt/homebrew/lib/python3.13/site-packages/sqlalchemy/orm/state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
/opt/homebrew/lib/python3.13/site-packages/sqlalchemy/orm/session.py:1288: in _prepare_impl
    self.session.flush()
/opt/homebrew/lib/python3.13/site-packages/sqlalchemy/orm/session.py:4345: in flush
    self._flush(objects)
/opt/homebrew/lib/python3.13/site-packages/sqlalchemy/orm/session.py:4480: in _flush
    with util.safe_reraise():
/opt/homebrew/lib/python3.13/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
/opt/homebrew/lib/python3.13/site-packages/sqlalchemy/orm/session.py:4441: in _flush
    flush_context.execute()
/opt/homebrew/lib/python3.13/site-packages/sqlalchemy/orm/unitofwork.py:466: in execute
    rec.execute(self)
/opt/homebrew/lib/python3.13/site-packages/sqlalchemy/orm/unitofwork.py:642: in execute
    util.preloaded.orm_persistence.save_obj(
/opt/homebrew/lib/python3.13/site-packages/sqlalchemy/orm/persistence.py:93: in save_obj
    _emit_insert_statements(
/opt/homebrew/lib/python3.13/site-packages/sqlalchemy/orm/persistence.py:1048: in _emit_insert_statements
    result = connection.execute(
/opt/homebrew/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1419: in execute
    return meth(
/opt/homebrew/lib/python3.13/site-packages/sqlalchemy/sql/elements.py:526: in _execute_on_connection
    return connection._execute_clauseelement(
/opt/homebrew/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1641: in _execute_clauseelement
    ret = self._execute_context(
/opt/homebrew/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1846: in _execute_context
    return self._exec_single_context(
/opt/homebrew/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
/opt/homebrew/lib/python3.13/site-packages/sqlalchemy/engine/base.py:2355: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
/opt/homebrew/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
/opt/homebrew/lib/python3.13/site-packages/sqlalchemy/engine/default.py:951: in do_execute
    cursor.execute(statement, parameters)
E   sqlalchemy.exc.IntegrityError: (sqlite3.IntegrityError) UNIQUE constraint failed: apps.hostname
E   [SQL: INSERT INTO apps (id, catalog_id, name, hostname, status, url, iframe_url, public_port, internal_port, lxc_id, node, created_at, updated_at, config, ports, volumes, environment, owner_id) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
E   [parameters: ('nginx-nginx-existing', 'nginx', 'NGINX', 'nginx-existing', 'running', 'http://10.20.0.100:80', None, 30000, 40000, 100, 'pve', '2025-10-05 11:31:54.619773', '2025-10-05 11:31:54.619776', '{"cpu_cores": 2, "memory_mb": 2048}', '{"80": 80}', '["/data/nginx:/usr/share/nginx/html"]', '{"ENV_VAR": "value"}', None)]
E   (Background on this error at: https://sqlalche.me/e/20/gkpj)

The above exception was the direct cause of the following exception:
tests/test_app_clone_config.py:176: in test_clone_app_duplicate_hostname
    await app_service.clone_app(source_app.id, "nginx-existing")
backend/services/app_service.py:822: in clone_app
    raise AppOperationError(
E   core.exceptions.AppOperationError: Failed to clone application: (sqlite3.IntegrityError) UNIQUE constraint failed: apps.hostname
E   [SQL: INSERT INTO apps (id, catalog_id, name, hostname, status, url, iframe_url, public_port, internal_port, lxc_id, node, created_at, updated_at, config, ports, volumes, environment, owner_id) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
E   [parameters: ('nginx-nginx-existing', 'nginx', 'NGINX', 'nginx-existing', 'running', 'http://10.20.0.100:80', None, 30000, 40000, 100, 'pve', '2025-10-05 11:31:54.619773', '2025-10-05 11:31:54.619776', '{"cpu_cores": 2, "memory_mb": 2048}', '{"80": 80}', '["/data/nginx:/usr/share/nginx/html"]', '{"ENV_VAR": "value"}', None)]
E   (Background on this error at: https://sqlalche.me/e/20/gkpj)
------------------------------ Captured log call -------------------------------
ERROR    services.app_service:app_service.py:805 Clone operation failed: (sqlite3.IntegrityError) UNIQUE constraint failed: apps.hostname
[SQL: INSERT INTO apps (id, catalog_id, name, hostname, status, url, iframe_url, public_port, internal_port, lxc_id, node, created_at, updated_at, config, ports, volumes, environment, owner_id) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('nginx-nginx-existing', 'nginx', 'NGINX', 'nginx-existing', 'running', 'http://10.20.0.100:80', None, 30000, 40000, 100, 'pve', '2025-10-05 11:31:54.619773', '2025-10-05 11:31:54.619776', '{"cpu_cores": 2, "memory_mb": 2048}', '{"80": 80}', '["/data/nginx:/usr/share/nginx/html"]', '{"ENV_VAR": "value"}', None)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
Traceback (most recent call last):
  File "/opt/homebrew/lib/python3.13/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
    ~~~~~~~~~~~~~~~~~~~~~~~^
        cursor, str_statement, effective_parameters, context
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/homebrew/lib/python3.13/site-packages/sqlalchemy/engine/default.py", line 951, in do_execute
    cursor.execute(statement, parameters)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^
sqlite3.IntegrityError: UNIQUE constraint failed: apps.hostname

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/fab/GitHub/proximity/backend/services/app_service.py", line 798, in clone_app
    self.db.commit()
    ~~~~~~~~~~~~~~^^
  File "/opt/homebrew/lib/python3.13/site-packages/sqlalchemy/orm/session.py", line 2032, in commit
    trans.commit(_to_root=True)
    ~~~~~~~~~~~~^^^^^^^^^^^^^^^
  File "<string>", line 2, in commit
  File "/opt/homebrew/lib/python3.13/site-packages/sqlalchemy/orm/state_changes.py", line 137, in _go
    ret_value = fn(self, *arg, **kw)
  File "/opt/homebrew/lib/python3.13/site-packages/sqlalchemy/orm/session.py", line 1313, in commit
    self._prepare_impl()
    ~~~~~~~~~~~~~~~~~~^^
  File "<string>", line 2, in _prepare_impl
  File "/opt/homebrew/lib/python3.13/site-packages/sqlalchemy/orm/state_changes.py", line 137, in _go
    ret_value = fn(self, *arg, **kw)
  File "/opt/homebrew/lib/python3.13/site-packages/sqlalchemy/orm/session.py", line 1288, in _prepare_impl
    self.session.flush()
    ~~~~~~~~~~~~~~~~~~^^
  File "/opt/homebrew/lib/python3.13/site-packages/sqlalchemy/orm/session.py", line 4345, in flush
    self._flush(objects)
    ~~~~~~~~~~~^^^^^^^^^
  File "/opt/homebrew/lib/python3.13/site-packages/sqlalchemy/orm/session.py", line 4480, in _flush
    with util.safe_reraise():
         ~~~~~~~~~~~~~~~~~^^
  File "/opt/homebrew/lib/python3.13/site-packages/sqlalchemy/util/langhelpers.py", line 224, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "/opt/homebrew/lib/python3.13/site-packages/sqlalchemy/orm/session.py", line 4441, in _flush
    flush_context.execute()
    ~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/homebrew/lib/python3.13/site-packages/sqlalchemy/orm/unitofwork.py", line 466, in execute
    rec.execute(self)
    ~~~~~~~~~~~^^^^^^
  File "/opt/homebrew/lib/python3.13/site-packages/sqlalchemy/orm/unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self.mapper,
        ^^^^^^^^^^^^
        uow.states_for_mapper_hierarchy(self.mapper, False, False),
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        uow,
        ^^^^
    )
    ^
  File "/opt/homebrew/lib/python3.13/site-packages/sqlalchemy/orm/persistence.py", line 93, in save_obj
    _emit_insert_statements(
    ~~~~~~~~~~~~~~~~~~~~~~~^
        base_mapper,
        ^^^^^^^^^^^^
    ...<3 lines>...
        insert,
        ^^^^^^^
    )
    ^
  File "/opt/homebrew/lib/python3.13/site-packages/sqlalchemy/orm/persistence.py", line 1048, in _emit_insert_statements
    result = connection.execute(
        statement, multiparams, execution_options=execution_options
    )
  File "/opt/homebrew/lib/python3.13/site-packages/sqlalchemy/engine/base.py", line 1419, in execute
    return meth(
        self,
        distilled_parameters,
        execution_options or NO_OPTIONS,
    )
  File "/opt/homebrew/lib/python3.13/site-packages/sqlalchemy/sql/elements.py", line 526, in _execute_on_connection
    return connection._execute_clauseelement(
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self, distilled_params, execution_options
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/homebrew/lib/python3.13/site-packages/sqlalchemy/engine/base.py", line 1641, in _execute_clauseelement
    ret = self._execute_context(
        dialect,
    ...<8 lines>...
        cache_hit=cache_hit,
    )
  File "/opt/homebrew/lib/python3.13/site-packages/sqlalchemy/engine/base.py", line 1846, in _execute_context
    return self._exec_single_context(
           ~~~~~~~~~~~~~~~~~~~~~~~~~^
        dialect, context, statement, parameters
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/homebrew/lib/python3.13/site-packages/sqlalchemy/engine/base.py", line 1986, in _exec_single_context
    self._handle_dbapi_exception(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        e, str_statement, effective_parameters, cursor, context
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/homebrew/lib/python3.13/site-packages/sqlalchemy/engine/base.py", line 2355, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/opt/homebrew/lib/python3.13/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
    ~~~~~~~~~~~~~~~~~~~~~~~^
        cursor, str_statement, effective_parameters, context
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/homebrew/lib/python3.13/site-packages/sqlalchemy/engine/default.py", line 951, in do_execute
    cursor.execute(statement, parameters)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^
sqlalchemy.exc.IntegrityError: (sqlite3.IntegrityError) UNIQUE constraint failed: apps.hostname
[SQL: INSERT INTO apps (id, catalog_id, name, hostname, status, url, iframe_url, public_port, internal_port, lxc_id, node, created_at, updated_at, config, ports, volumes, environment, owner_id) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('nginx-nginx-existing', 'nginx', 'NGINX', 'nginx-existing', 'running', 'http://10.20.0.100:80', None, 30000, 40000, 100, 'pve', '2025-10-05 11:31:54.619773', '2025-10-05 11:31:54.619776', '{"cpu_cores": 2, "memory_mb": 2048}', '{"80": 80}', '["/data/nginx:/usr/share/nginx/html"]', '{"ENV_VAR": "value"}', None)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
ERROR    services.port_manager:port_manager.py:196 Error releasing ports for app nginx-nginx-existing: This Session's transaction has been rolled back due to a previous exception during flush. To begin a new transaction with this Session, first issue Session.rollback(). Original exception was: (sqlite3.IntegrityError) UNIQUE constraint failed: apps.hostname
[SQL: INSERT INTO apps (id, catalog_id, name, hostname, status, url, iframe_url, public_port, internal_port, lxc_id, node, created_at, updated_at, config, ports, volumes, environment, owner_id) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('nginx-nginx-existing', 'nginx', 'NGINX', 'nginx-existing', 'running', 'http://10.20.0.100:80', None, 30000, 40000, 100, 'pve', '2025-10-05 11:31:54.619773', '2025-10-05 11:31:54.619776', '{"cpu_cores": 2, "memory_mb": 2048}', '{"80": 80}', '["/data/nginx:/usr/share/nginx/html"]', '{"ENV_VAR": "value"}', None)]
(Background on this error at: https://sqlalche.me/e/20/gkpj) (Background on this error at: https://sqlalche.me/e/20/7s2a)
Traceback (most recent call last):
  File "/opt/homebrew/lib/python3.13/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
    ~~~~~~~~~~~~~~~~~~~~~~~^
        cursor, str_statement, effective_parameters, context
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/homebrew/lib/python3.13/site-packages/sqlalchemy/engine/default.py", line 951, in do_execute
    cursor.execute(statement, parameters)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^
sqlite3.IntegrityError: UNIQUE constraint failed: apps.hostname

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/fab/GitHub/proximity/backend/services/app_service.py", line 798, in clone_app
    self.db.commit()
    ~~~~~~~~~~~~~~^^
  File "/opt/homebrew/lib/python3.13/site-packages/sqlalchemy/orm/session.py", line 2032, in commit
    trans.commit(_to_root=True)
    ~~~~~~~~~~~~^^^^^^^^^^^^^^^
  File "<string>", line 2, in commit
  File "/opt/homebrew/lib/python3.13/site-packages/sqlalchemy/orm/state_changes.py", line 137, in _go
    ret_value = fn(self, *arg, **kw)
  File "/opt/homebrew/lib/python3.13/site-packages/sqlalchemy/orm/session.py", line 1313, in commit
    self._prepare_impl()
    ~~~~~~~~~~~~~~~~~~^^
  File "<string>", line 2, in _prepare_impl
  File "/opt/homebrew/lib/python3.13/site-packages/sqlalchemy/orm/state_changes.py", line 137, in _go
    ret_value = fn(self, *arg, **kw)
  File "/opt/homebrew/lib/python3.13/site-packages/sqlalchemy/orm/session.py", line 1288, in _prepare_impl
    self.session.flush()
    ~~~~~~~~~~~~~~~~~~^^
  File "/opt/homebrew/lib/python3.13/site-packages/sqlalchemy/orm/session.py", line 4345, in flush
    self._flush(objects)
    ~~~~~~~~~~~^^^^^^^^^
  File "/opt/homebrew/lib/python3.13/site-packages/sqlalchemy/orm/session.py", line 4480, in _flush
    with util.safe_reraise():
         ~~~~~~~~~~~~~~~~~^^
  File "/opt/homebrew/lib/python3.13/site-packages/sqlalchemy/util/langhelpers.py", line 224, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "/opt/homebrew/lib/python3.13/site-packages/sqlalchemy/orm/session.py", line 4441, in _flush
    flush_context.execute()
    ~~~~~~~~~~~~~~~~~~~~~^^
  File "/opt/homebrew/lib/python3.13/site-packages/sqlalchemy/orm/unitofwork.py", line 466, in execute
    rec.execute(self)
    ~~~~~~~~~~~^^^^^^
  File "/opt/homebrew/lib/python3.13/site-packages/sqlalchemy/orm/unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self.mapper,
        ^^^^^^^^^^^^
        uow.states_for_mapper_hierarchy(self.mapper, False, False),
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        uow,
        ^^^^
    )
    ^
  File "/opt/homebrew/lib/python3.13/site-packages/sqlalchemy/orm/persistence.py", line 93, in save_obj
    _emit_insert_statements(
    ~~~~~~~~~~~~~~~~~~~~~~~^
        base_mapper,
        ^^^^^^^^^^^^
    ...<3 lines>...
        insert,
        ^^^^^^^
    )
    ^
  File "/opt/homebrew/lib/python3.13/site-packages/sqlalchemy/orm/persistence.py", line 1048, in _emit_insert_statements
    result = connection.execute(
        statement, multiparams, execution_options=execution_options
    )
  File "/opt/homebrew/lib/python3.13/site-packages/sqlalchemy/engine/base.py", line 1419, in execute
    return meth(
        self,
        distilled_parameters,
        execution_options or NO_OPTIONS,
    )
  File "/opt/homebrew/lib/python3.13/site-packages/sqlalchemy/sql/elements.py", line 526, in _execute_on_connection
    return connection._execute_clauseelement(
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self, distilled_params, execution_options
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/homebrew/lib/python3.13/site-packages/sqlalchemy/engine/base.py", line 1641, in _execute_clauseelement
    ret = self._execute_context(
        dialect,
    ...<8 lines>...
        cache_hit=cache_hit,
    )
  File "/opt/homebrew/lib/python3.13/site-packages/sqlalchemy/engine/base.py", line 1846, in _execute_context
    return self._exec_single_context(
           ~~~~~~~~~~~~~~~~~~~~~~~~~^
        dialect, context, statement, parameters
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/homebrew/lib/python3.13/site-packages/sqlalchemy/engine/base.py", line 1986, in _exec_single_context
    self._handle_dbapi_exception(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        e, str_statement, effective_parameters, cursor, context
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/homebrew/lib/python3.13/site-packages/sqlalchemy/engine/base.py", line 2355, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/opt/homebrew/lib/python3.13/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
    ~~~~~~~~~~~~~~~~~~~~~~~^
        cursor, str_statement, effective_parameters, context
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/homebrew/lib/python3.13/site-packages/sqlalchemy/engine/default.py", line 951, in do_execute
    cursor.execute(statement, parameters)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^
sqlalchemy.exc.IntegrityError: (sqlite3.IntegrityError) UNIQUE constraint failed: apps.hostname
[SQL: INSERT INTO apps (id, catalog_id, name, hostname, status, url, iframe_url, public_port, internal_port, lxc_id, node, created_at, updated_at, config, ports, volumes, environment, owner_id) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('nginx-nginx-existing', 'nginx', 'NGINX', 'nginx-existing', 'running', 'http://10.20.0.100:80', None, 30000, 40000, 100, 'pve', '2025-10-05 11:31:54.619773', '2025-10-05 11:31:54.619776', '{"cpu_cores": 2, "memory_mb": 2048}', '{"80": 80}', '["/data/nginx:/usr/share/nginx/html"]', '{"ENV_VAR": "value"}', None)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/fab/GitHub/proximity/backend/services/port_manager.py", line 183, in release_ports_for_app
    app = self.db.query(DBApp).filter(DBApp.id == app_id).first()
  File "/opt/homebrew/lib/python3.13/site-packages/sqlalchemy/orm/query.py", line 2759, in first
    return self.limit(1)._iter().first()  # type: ignore
           ~~~~~~~~~~~~~~~~~~~^^
  File "/opt/homebrew/lib/python3.13/site-packages/sqlalchemy/orm/query.py", line 2857, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
                                                  ~~~~~~~~~~~~~~~~~~~~^
        statement,
        ^^^^^^^^^^
        params,
        ^^^^^^^
        execution_options={"_sa_orm_load_options": self.load_options},
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/homebrew/lib/python3.13/site-packages/sqlalchemy/orm/session.py", line 2365, in execute
    return self._execute_internal(
           ~~~~~~~~~~~~~~~~~~~~~~^
        statement,
        ^^^^^^^^^^
    ...<4 lines>...
        _add_event=_add_event,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/homebrew/lib/python3.13/site-packages/sqlalchemy/orm/session.py", line 2241, in _execute_internal
    conn = self._connection_for_bind(bind)
  File "/opt/homebrew/lib/python3.13/site-packages/sqlalchemy/orm/session.py", line 2110, in _connection_for_bind
    return trans._connection_for_bind(engine, execution_options)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "<string>", line 2, in _connection_for_bind
  File "/opt/homebrew/lib/python3.13/site-packages/sqlalchemy/orm/state_changes.py", line 101, in _go
    self._raise_for_prerequisite_state(fn.__name__, current_state)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/lib/python3.13/site-packages/sqlalchemy/orm/session.py", line 973, in _raise_for_prerequisite_state
    raise sa_exc.PendingRollbackError(
    ...<6 lines>...
    )
sqlalchemy.exc.PendingRollbackError: This Session's transaction has been rolled back due to a previous exception during flush. To begin a new transaction with this Session, first issue Session.rollback(). Original exception was: (sqlite3.IntegrityError) UNIQUE constraint failed: apps.hostname
[SQL: INSERT INTO apps (id, catalog_id, name, hostname, status, url, iframe_url, public_port, internal_port, lxc_id, node, created_at, updated_at, config, ports, volumes, environment, owner_id) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('nginx-nginx-existing', 'nginx', 'NGINX', 'nginx-existing', 'running', 'http://10.20.0.100:80', None, 30000, 40000, 100, 'pve', '2025-10-05 11:31:54.619773', '2025-10-05 11:31:54.619776', '{"cpu_cores": 2, "memory_mb": 2048}', '{"80": 80}', '["/data/nginx:/usr/share/nginx/html"]', '{"ENV_VAR": "value"}', None)]
(Background on this error at: https://sqlalche.me/e/20/gkpj) (Background on this error at: https://sqlalche.me/e/20/7s2a)
______________ TestCloneApp.test_clone_app_copies_all_properties _______________
tests/test_app_clone_config.py:231: in test_clone_app_copies_all_properties
    assert cloned.ports == source_app.ports
E   AssertionError: assert {80: 80} == {'80': 80}
E     
E     Left contains 1 more item:
E     {80: 80}
E     Right contains 1 more item:
E     {'80': 80}
E     
E     Full diff:...
E     
E     ...Full output truncated (5 lines hidden), use '-vv' to show
__________________ TestUpdateAppConfig.test_update_cpu_cores ___________________
/opt/homebrew/Cellar/python@3.13/3.13.7/Frameworks/Python.framework/Versions/3.13/lib/python3.13/unittest/mock.py:990: in assert_called_once_with
    raise AssertionError(msg)
E   AssertionError: Expected 'stop_app' to be called once. Called 0 times.

During handling of the above exception, another exception occurred:
tests/test_app_clone_config.py:271: in test_update_cpu_cores
    mock_stop.assert_called_once_with(running_app.id)
E   AssertionError: Expected 'stop_app' to be called once. Called 0 times.
____________________ TestUpdateAppConfig.test_update_memory ____________________
tests/test_app_clone_config.py:297: in test_update_memory
    assert call_args.kwargs['config']['memory'] == 4096
E   KeyError: 'config'
__________________ TestUpdateAppConfig.test_update_disk_size ___________________
tests/test_app_clone_config.py:320: in test_update_disk_size
    assert db_app.config['disk_gb'] == 20
E   assert 10 == 20
______________ TestUpdateAppConfig.test_update_multiple_resources ______________
tests/test_app_clone_config.py:344: in test_update_multiple_resources
    assert db_app.config['cpu_cores'] == 4
E   assert 1 == 4
________________ TestUpdateAppConfig.test_update_app_not_found _________________
tests/test_app_clone_config.py:358: in test_update_app_not_found
    await app_service.update_app_config("nonexistent-app", cpu_cores=2)
backend/services/app_service.py:862: in update_app_config
    app = await self.get_app(app_id)
backend/services/app_service.py:321: in get_app
    raise AppServiceError(f"App '{app_id}' not found")
E   services.app_service.AppServiceError: App 'nonexistent-app' not found
___________ TestUpdateAppConfig.test_update_failure_attempts_restart ___________
/opt/homebrew/Cellar/python@3.13/3.13.7/Frameworks/Python.framework/Versions/3.13/lib/python3.13/unittest/mock.py:958: in assert_called_once
    raise AssertionError(msg)
E   AssertionError: Expected 'start_app' to have been called once. Called 0 times.

During handling of the above exception, another exception occurred:
tests/test_app_clone_config.py:403: in test_update_failure_attempts_restart
    mock_start.assert_called_once()
E   AssertionError: Expected 'start_app' to have been called once. Called 0 times.
------------------------------ Captured log call -------------------------------
ERROR    services.app_service:app_service.py:913 Config update failed for nginx-config: Update failed
Traceback (most recent call last):
  File "/Users/fab/GitHub/proximity/backend/services/app_service.py", line 883, in update_app_config
    await self.proxmox_service.update_lxc_config(app.node, app.lxc_id, config_updates)
  File "/opt/homebrew/Cellar/python@3.13/3.13.7/Frameworks/Python.framework/Versions/3.13/lib/python3.13/unittest/mock.py", line 2321, in _execute_mock_call
    raise effect
Exception: Update failed
______________________ TestProxmoxService.test_get_nodes _______________________
tests/test_proxmox_service.py:24: in test_get_nodes
    assert nodes[0]["node"] == "testnode"
E   AssertionError: assert <MagicMock name='mock.__getitem__()' id='4561707968'> == 'testnode'
=============================== warnings summary ===============================
backend/models/database.py:29
backend/models/database.py:29
  /Users/fab/GitHub/proximity/backend/models/database.py:29: MovedIn20Warning: The ``declarative_base()`` function is now available as sqlalchemy.orm.declarative_base(). (deprecated since: 2.0) (Background on SQLAlchemy 2.0 at: https://sqlalche.me/e/b8d9)
    Base = declarative_base()

tests/test_api_endpoints.py: 30 warnings
tests/test_app_clone_config.py: 46 warnings
tests/test_app_service.py: 28 warnings
tests/test_auth_service.py: 26 warnings
tests/test_backup_api.py: 64 warnings
tests/test_backup_model.py: 77 warnings
tests/test_backup_service.py: 68 warnings
tests/test_database_models.py: 113 warnings
tests/test_database_transactions.py: 67 warnings
tests/test_error_handling.py: 52 warnings
tests/test_integration.py: 18 warnings
tests/test_port_manager.py: 40 warnings
  /opt/homebrew/lib/python3.13/site-packages/sqlalchemy/sql/schema.py:3624: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
    return util.wrap_callable(lambda ctx: fn(), fn)  # type: ignore

tests/test_api_endpoints.py: 11 warnings
tests/test_auth_service.py: 4 warnings
tests/test_backup_api.py: 13 warnings
tests/test_error_handling.py: 5 warnings
tests/test_integration.py: 8 warnings
  /Users/fab/GitHub/proximity/backend/services/auth_service.py:44: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
    expire = datetime.utcnow() + (expires_delta or timedelta(minutes=ACCESS_TOKEN_EXPIRE_MINUTES))

tests/test_api_endpoints.py: 11 warnings
tests/test_auth_service.py: 4 warnings
tests/test_backup_api.py: 13 warnings
tests/test_error_handling.py: 5 warnings
tests/test_integration.py: 8 warnings
  /Users/fab/GitHub/proximity/backend/services/auth_service.py:47: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
    "iat": datetime.utcnow()

tests/test_api_endpoints.py: 20 warnings
tests/test_integration.py: 9 warnings
  /opt/homebrew/lib/python3.13/site-packages/urllib3/connectionpool.py:1064: InsecureRequestWarning: Unverified HTTPS request is being made to host '192.168.100.102'. Adding certificate verification is strongly advised. See: https://urllib3.readthedocs.io/en/1.26.x/advanced-usage.html#ssl-warnings
    warnings.warn(

tests/test_api_endpoints.py::TestAppEndpoints::test_deploy_app
tests/test_app_service.py::TestAppService::test_deploy_app_success
tests/test_app_service.py::TestAppService::test_deployment_with_proxy
tests/test_database_transactions.py::TestTransactionDurability::test_deployed_app_persists
tests/test_database_transactions.py::TestMultipleOperations::test_deploy_start_stop_delete_sequence
tests/test_error_handling.py::TestEdgeCases::test_concurrent_deployments_same_hostname
  /Users/fab/GitHub/proximity/backend/services/app_service.py:1126: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
    created_at=datetime.utcnow(),

tests/test_api_endpoints.py::TestAppEndpoints::test_deploy_app
tests/test_app_service.py::TestAppService::test_deploy_app_success
tests/test_app_service.py::TestAppService::test_deployment_with_proxy
tests/test_database_transactions.py::TestTransactionDurability::test_deployed_app_persists
tests/test_database_transactions.py::TestMultipleOperations::test_deploy_start_stop_delete_sequence
tests/test_error_handling.py::TestEdgeCases::test_concurrent_deployments_same_hostname
  /Users/fab/GitHub/proximity/backend/services/app_service.py:1127: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
    updated_at=datetime.utcnow()

tests/test_api_endpoints.py::TestAppEndpoints::test_deploy_app
tests/test_app_service.py::TestAppService::test_deploy_app_success
tests/test_app_service.py::TestAppService::test_deployment_with_proxy
tests/test_database_transactions.py::TestTransactionDurability::test_deployed_app_persists
tests/test_database_transactions.py::TestMultipleOperations::test_deploy_start_stop_delete_sequence
tests/test_error_handling.py::TestEdgeCases::test_concurrent_deployments_same_hostname
  /Users/fab/GitHub/proximity/backend/services/app_service.py:1338: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
    timestamp=datetime.utcnow(),

tests/test_app_clone_config.py::TestCloneApp::test_clone_app_success
tests/test_app_clone_config.py::TestCloneApp::test_clone_app_duplicate_hostname
tests/test_app_clone_config.py::TestCloneApp::test_clone_app_copies_all_properties
  /Users/fab/GitHub/proximity/backend/services/app_service.py:794: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
    created_at=datetime.utcnow(),

tests/test_app_clone_config.py::TestCloneApp::test_clone_app_success
tests/test_app_clone_config.py::TestCloneApp::test_clone_app_duplicate_hostname
tests/test_app_clone_config.py::TestCloneApp::test_clone_app_copies_all_properties
  /Users/fab/GitHub/proximity/backend/services/app_service.py:795: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
    updated_at=datetime.utcnow()

tests/test_app_clone_config.py::TestUpdateAppConfig::test_update_cpu_cores
tests/test_app_clone_config.py::TestUpdateAppConfig::test_update_memory
tests/test_app_clone_config.py::TestUpdateAppConfig::test_update_disk_size
tests/test_app_clone_config.py::TestUpdateAppConfig::test_update_multiple_resources
tests/test_app_clone_config.py::TestUpdateAppConfig::test_update_stopped_app_no_restart
  /Users/fab/GitHub/proximity/backend/services/app_service.py:903: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
    db_app.updated_at = datetime.utcnow()

tests/test_app_service.py::TestAppService::test_start_app
tests/test_app_service.py::TestAppService::test_restart_app
tests/test_database_transactions.py::TestTransactionConsistency::test_app_status_consistency
tests/test_database_transactions.py::TestMultipleOperations::test_deploy_start_stop_delete_sequence
  /Users/fab/GitHub/proximity/backend/services/app_service.py:450: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
    db_app.updated_at = datetime.utcnow()

tests/test_app_service.py::TestAppService::test_stop_app
tests/test_app_service.py::TestAppService::test_restart_app
tests/test_app_service.py::TestAppService::test_delete_app_success
tests/test_database_transactions.py::TestTransactionAtomicity::test_delete_app_rollback_on_error
tests/test_database_transactions.py::TestMultipleOperations::test_deploy_start_stop_delete_sequence
tests/test_database_transactions.py::TestMultipleOperations::test_deploy_start_stop_delete_sequence
  /Users/fab/GitHub/proximity/backend/services/app_service.py:506: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
    db_app.updated_at = datetime.utcnow()

tests/test_app_service.py::TestAppServiceUpdate::test_update_app_creates_pre_update_backup
tests/test_app_service.py::TestAppServiceUpdate::test_update_app_runs_pull_and_up_commands
  /Users/fab/GitHub/proximity/backend/services/app_service.py:1512: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
    app.updated_at = datetime.utcnow()

tests/test_backup_api.py::TestBackupAPICreate::test_create_backup_success
tests/test_backup_service.py::TestBackupServiceCreate::test_create_backup_success
tests/test_backup_service.py::TestBackupServiceCreate::test_create_backup_proxmox_failure
tests/test_backup_service.py::TestBackupServiceCreate::test_create_backup_with_custom_compression
  /Users/fab/GitHub/proximity/backend/services/backup_service.py:71: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
    timestamp = datetime.utcnow().strftime("%Y_%m_%d-%H_%M_%S")

tests/test_backup_api.py::TestBackupAPICreate::test_create_backup_success
tests/test_backup_service.py::TestBackupServiceCreate::test_create_backup_success
tests/test_backup_service.py::TestBackupServiceCreate::test_create_backup_with_custom_compression
tests/test_backup_service.py::TestBackupServicePolling::test_poll_backup_completion_success
tests/test_backup_service.py::TestBackupServicePolling::test_poll_backup_completion_failed
  /Users/fab/GitHub/proximity/backend/services/backup_service.py:274: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
    start_time = datetime.utcnow().timestamp()

tests/test_backup_model.py::TestBackupModel::test_backup_status_transitions
  /Users/fab/GitHub/proximity/tests/test_backup_model.py:156: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
    backup.completed_at = datetime.utcnow()

tests/test_backup_service.py::TestBackupServiceCreate::test_create_backup_success
  /Users/fab/GitHub/proximity/tests/test_backup_service.py:51: RuntimeWarning: coroutine 'AsyncMockMixin._execute_mock_call' was never awaited
    backup = await backup_service.create_backup(
  Enable tracemalloc to get traceback where the object was allocated.
  See https://docs.pytest.org/en/stable/how-to/capture-warnings.html#resource-warnings for more info.

tests/test_backup_service.py::TestBackupServiceCreate::test_create_backup_with_custom_compression
  /opt/homebrew/lib/python3.13/site-packages/sqlalchemy/orm/unitofwork.py:495: RuntimeWarning: coroutine 'AsyncMockMixin._execute_mock_call' was never awaited
    return iter(
  Enable tracemalloc to get traceback where the object was allocated.
  See https://docs.pytest.org/en/stable/how-to/capture-warnings.html#resource-warnings for more info.

tests/test_backup_service.py::TestBackupServiceCreate::test_create_backup_with_custom_compression
  /Users/fab/GitHub/proximity/tests/test_backup_service.py:147: RuntimeWarning: coroutine 'AsyncMockMixin._execute_mock_call' was never awaited
    backup = await backup_service.create_backup(
  Enable tracemalloc to get traceback where the object was allocated.
  See https://docs.pytest.org/en/stable/how-to/capture-warnings.html#resource-warnings for more info.

tests/test_backup_service.py::TestBackupServicePolling::test_poll_backup_completion_success
  /Users/fab/GitHub/proximity/tests/test_backup_service.py:564: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
    "ctime": datetime.utcnow().timestamp()

tests/test_backup_service.py::TestBackupServicePolling::test_poll_backup_completion_success
  /Users/fab/GitHub/proximity/backend/services/backup_service.py:300: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
    backup.completed_at = datetime.utcnow()

tests/test_backup_service.py::TestBackupServicePolling::test_poll_backup_completion_failed
  /Users/fab/GitHub/proximity/backend/services/backup_service.py:309: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
    if datetime.utcnow().timestamp() - start_time > timeout:

tests/test_database_transactions.py::TestTransactionConsistency::test_app_status_consistency_on_error
tests/test_error_handling.py::TestAppServiceErrors::test_start_app_proxmox_failure
  /Users/fab/GitHub/proximity/backend/services/app_service.py:463: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
    db_app.updated_at = datetime.utcnow()

tests/test_error_handling.py::TestAppServiceErrors::test_stop_app_proxmox_failure
  /Users/fab/GitHub/proximity/backend/services/app_service.py:519: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
    db_app.updated_at = datetime.utcnow()

tests/test_error_handling.py::TestAPIEndpointErrors::test_invalid_json_payload
  /opt/homebrew/lib/python3.13/site-packages/httpx/_models.py:408: DeprecationWarning: Use 'content=<...>' to upload raw bytes/text content.
    headers, stream = encode_request(

tests/test_monitoring_service.py: 11 warnings
  /Users/fab/GitHub/proximity/backend/services/monitoring_service.py:188: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
    "timestamp": datetime.utcnow().isoformat() + "Z"

tests/test_monitoring_service.py: 11 warnings
  /Users/fab/GitHub/proximity/backend/services/monitoring_service.py:194: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
    self._cache[lxc_id] = (datetime.utcnow(), metrics)

tests/test_monitoring_service.py::TestMonitoringService::test_get_current_app_stats_uses_cache
tests/test_monitoring_service.py::TestMonitoringService::test_get_current_app_stats_uses_cache
tests/test_monitoring_service.py::TestMonitoringService::test_get_current_app_stats_cache_expires
  /Users/fab/GitHub/proximity/backend/services/monitoring_service.py:105: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
    age = (datetime.utcnow() - cached_time).total_seconds()

tests/test_monitoring_service.py::TestMonitoringService::test_get_cache_stats
  /Users/fab/GitHub/proximity/backend/services/monitoring_service.py:223: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
    now = datetime.utcnow()

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
=========================== short test summary info ============================
FAILED tests/test_app_clone_config.py::TestCloneApp::test_clone_app_success
FAILED tests/test_app_clone_config.py::TestCloneApp::test_clone_app_source_not_found
FAILED tests/test_app_clone_config.py::TestCloneApp::test_clone_app_duplicate_hostname
FAILED tests/test_app_clone_config.py::TestCloneApp::test_clone_app_copies_all_properties
FAILED tests/test_app_clone_config.py::TestUpdateAppConfig::test_update_cpu_cores
FAILED tests/test_app_clone_config.py::TestUpdateAppConfig::test_update_memory
FAILED tests/test_app_clone_config.py::TestUpdateAppConfig::test_update_disk_size
FAILED tests/test_app_clone_config.py::TestUpdateAppConfig::test_update_multiple_resources
FAILED tests/test_app_clone_config.py::TestUpdateAppConfig::test_update_app_not_found
FAILED tests/test_app_clone_config.py::TestUpdateAppConfig::test_update_failure_attempts_restart
FAILED tests/test_proxmox_service.py::TestProxmoxService::test_get_nodes - As...
=========== 11 failed, 248 passed, 829 warnings in 296.98s (0:04:56) ===========
